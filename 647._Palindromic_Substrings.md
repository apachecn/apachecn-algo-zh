### 647. Palindromic Substrings

é¢˜ç›®:
<https://leetcode.com/problems/Palindromic-Substrings/>


éš¾åº¦:

Medium


æ€è·¯

è¿™é“é¢˜è¦æ±‚ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å›æ–‡å­ä¸²çš„ä¸ªæ•°ï¼Œæ‰€ä»¥æˆ‘æƒ³åˆ°äº†Manacherç®—æ³•ï¼Œ
[Manacherç®—æ³•](https://www.felix021.com/blog/read.php?2040) 

Manacherç®—æ³•å¢åŠ ä¸¤ä¸ªè¾…åŠ©å˜é‡idå’Œmxï¼Œå…¶ä¸­idè¡¨ç¤ºæœ€å¤§å›æ–‡å­ä¸²ä¸­å¿ƒçš„ä½ç½®ï¼Œmxåˆ™ä¸ºid+P[id]ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§å›æ–‡å­ä¸²çš„è¾¹ç•Œã€‚å¾—åˆ°ä¸€ä¸ªå¾ˆé‡è¦çš„ç»“è®ºï¼š

- å¦‚æœmx > iï¼Œé‚£ä¹ˆP[i] >= Min(P[2 * id - i], mx - i) . ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Œä¸‹é¢è§£é‡Š

ä¸‹é¢ï¼Œä»¤j = 2*id - iï¼Œä¹Ÿå°±æ˜¯è¯´jæ˜¯iå…³äºidçš„å¯¹ç§°ç‚¹ã€‚

- å½“ mx - i > P[j] çš„æ—¶å€™ï¼Œä»¥S[j]ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²åŒ…å«åœ¨ä»¥S[id]ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ä¸­ï¼Œç”±äºiå’Œjå¯¹ç§°ï¼Œä»¥S[i]ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²å¿…ç„¶åŒ…å«åœ¨ä»¥S[id]ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ä¸­ï¼Œæ‰€ä»¥å¿…æœ‰P[i] = P[j]ï¼›
![](https://github.com/Lisanaaa/myTODOs/blob/master/manacher1.png)

- å½“ P[j] >= mx - i çš„æ—¶å€™ï¼Œä»¥S[j]ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ä¸ä¸€å®šå®Œå…¨åŒ…å«äºä»¥S[id]ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ä¸­ï¼Œä½†æ˜¯åŸºäºå¯¹ç§°æ€§å¯çŸ¥ï¼Œä¸‹å›¾ä¸­ä¸¤ä¸ªç»¿æ¡†æ‰€åŒ…å›´çš„éƒ¨åˆ†æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä»¥S[i]ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ï¼Œå…¶å‘å³è‡³å°‘ä¼šæ‰©å¼ åˆ°mxçš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ P[i] >= mx - iã€‚è‡³äºmxä¹‹åçš„éƒ¨åˆ†æ˜¯å¦å¯¹ç§°ï¼Œå†å…·ä½“åŒ¹é…ã€‚
![](https://github.com/Lisanaaa/myTODOs/blob/master/manacher2.png)
æ‰€ä»¥P[i] >= Min(P[2 * id - i], mx - i)ï¼Œå› ä¸ºä»¥jä¸ºä¸­å¿ƒçš„ç»˜å›æ–‡å­ä¸²çš„å·¦è¾¹ç•Œå¯èƒ½ä¼šæ¯”mxå…³äºidçš„å¯¹ç§°ç‚¹è¦å¤§ï¼Œæ­¤æ—¶åªèƒ½è¯æ˜P[i]=P[2 * id - i]
- æ­¤å¤–ï¼Œå¯¹äº mx <= i çš„æƒ…å†µï¼Œå› ä¸ºæ— æ³•å¯¹ P[i]åšæ›´å¤šçš„å‡è®¾ï¼Œåªèƒ½è®©P[i] = 1ï¼Œç„¶åå†å»åŒ¹é…ã€‚
æ­¤é¢˜è¿˜å¯ä»¥å€Ÿé‰´æˆ‘leetcodeç¬¬5é¢˜çš„è§£æï¼Œ
[thining-in-lc-5](https://github.com/Lisanaaa/thinking_in_lc/blob/master/005._longest_palindromic_substring.md)

è¿™é“é¢˜çš„åŸºæœ¬æ€æƒ³æ˜¯å°†ä»¥æ¯ä¸€ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ä¸ªæ•°ç›¸åŠ ï¼Œè¿˜æ˜¯ç”¨ä¸€ä¸ªå°ä¾‹å­æ¥è§£é‡Š
![](https://github.com/Lisanaaa/myTODOs/blob/master/manacher3.jpg)
å…¶å®ï¼Œä»¥â€˜#â€™ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²å°±ä»£è¡¨è¿™ä¸ªå­ä¸²çš„é•¿åº¦æ˜¯å¶æ•°ï¼Œç±»ä¼¼äº'abba'è¿™ç§
ä½†æ˜¯å…¶å®è¿™ä¸ªå­—ç¬¦æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå›æ–‡å­ä¸²ï¼Œæ‰€ä»¥å åŠ çš„å½¢å¼æ˜¯count += (P[i]+1)/2ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Œä»¥ä¸‹æ˜¯è§£é‡Šï¼š
- å¯¹äºæ¯ä¸€ä¸ªä»¥å­—ç¬¦â€˜#â€™ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ï¼Œå…¶På€¼ç»å¯¹æ˜¯å¶æ•°ï¼Œæ‰€ä»¥```(P[i]+1)/2 = P[i]/2```ï¼Œå¹¶ä¸å½±å“
- å¯¹äºæ¯ä¸€ä¸ªä»¥éå­—ç¬¦â€˜#â€™ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²ï¼Œå…¶På€¼ç»å¯¹æ˜¯å¥‡æ•°ï¼Œè¿™å°±ä¿è¯äº†å•ä¸ªå­—æ¯çš„å›æ–‡å­ä¸²(```ä¾‹å¦‚'a'ä¹Ÿç®—ä¸€ä¸ªå›æ–‡å­ä¸²```)ä¹Ÿè¢«åŠ èµ·æ¥äº†ï¼Œå› ä¸º```(P[i]+1)/2 = P[i]/2+1```


```python
class Solution(object):
    def countSubstrings(self, s):
        """
        :type s: str
        :rtype: str
        """
        def preProcess(s):
            if not s:
                return ['^', '$']
            T = ['^']
            for c in s:
                T += ['#', c]
            T += ['#', '$']
            return T
        T = preProcess(s)
        P = [0] * len(T)
        id, mx, count = 0, 0, 0
        for i in range(1,len(T) - 1):
            j = 2*id - i
            if mx > i:
                P[i] = min(mx - i, P[j])
            else:
                P[i] = 0
            while T[i+P[i]+1] == T[i-P[i]-1]:
                P[i] += 1
            if (i + P[i]) > mx:
                id, mx = i, i + P[i]
        for i in range(len(P)):
            count += (P[i]+1)/2
        return count
```
pythonæ— æ•Œå•Šï¼ï¼ï¼æœ‰æ²¡æœ‰å¤©ç†å•Šï¼Œæ‰‹åŠ¨æ»‘ç¨½ğŸ˜ğŸ˜ğŸ˜ğŸ˜ï¼ä¸€è¡Œè§£æ³•ï¼š
```python
class Solution(object):
    def countSubstrings(self, s):
        """
        :type s: str
        :rtype: int
        """
        return sum(len(os.path.commonprefix((s[:i][::-1], s[i:]))) 
                   + len(os.path.commonprefix((s[:i][::-1], s[i + 1:]))) + 1 
                        for i in range(len(s)))
```
è§£é‡Šä¸‹ä¸ºå•¥è¦åŠ ä¸¤æ¬¡ï¼Œå› ä¸ºå›æ–‡ä¸²æœ‰ä»¥ä¸‹ä¸¤ç§å½¢å¼ï¼š
- â€˜abcbaâ€™
- 'abba'

é‚£ä¸ºå•¥è¦åŠ é‚£ä¸ª1å‘¢ï¼Œä¸Šé¢è§£é‡Šè¿‡äº†ï¼Œå•ä¸ªå­—ç¬¦ä¹Ÿç®—æ˜¯ä¸€ä¸ªå›æ–‡å­ä¸²å‘€ï¼Œå˜»å˜»ğŸ˜
